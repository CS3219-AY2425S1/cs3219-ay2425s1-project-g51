<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        select, input {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }
        button {
            padding: 10px 20px;
            margin-right: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        button.cancel {
            background-color: #f44336;
        }
        button.cancel:hover {
            background-color: #da190b;
        }
        #messages {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            height: 300px;
            overflow-y: auto;
        }
        #messages p {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>
<body>
    <h1>WebSocket Test</h1>
    <div class="form-group">
        <label for="userId">User ID:</label>
        <input type="text" id="userId" required>
    </div>
    <div class="form-group">
        <label for="topic">Topic:</label>
        <select id="topic">
            <option value="Strings">Strings</option>
            <option value="Algorithms">Algorithms</option>
            <option value="Data Structures">Data Structures</option>
            <option value="Bit Manipulation">Bit Manipulation</option>
            <option value="Recursion">Recursion</option>
            <option value="Databases">Databases</option>
            <option value="Arrays">Arrays</option>
            <option value="Brainteaser">Brainteaser</option>
            <option value="Other">Other</option>
        </select>
    </div>
    <div class="form-group">
        <label for="difficulty">Difficulty:</label>
        <select id="difficulty">
            <option value="easy">Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
        </select>
    </div>
    
    <button onclick="requestMatch()">Request Match</button>
    <button onclick="cancelMatch()" class="cancel">Cancel Match</button>
    <div id="messages"></div>

    <script>
        const socket = io('ws://localhost:3002');
        
        socket.on('connect', () => {
            console.log('Connected to WebSocket');
            addMessage('Connected to WebSocket');
        });

        socket.on('requestAcknowledged', (data) => {
            console.log('Request acknowledged:', data);
            addMessage('Request acknowledged: ' + JSON.stringify(data));
        });

        socket.on('cancelAcknowledged', (data) => {
            console.log('Cancel acknowledged:', data);
            addMessage('Cancel acknowledged: ' + JSON.stringify(data));
        });

        socket.on('matchError', (data) => {
            console.log('Error:', data);
            addMessage('Error: ' + JSON.stringify(data));
        });

        socket.on('matchResult', (data) => {
            console.log('Match result:', data);
            addMessage('Match result: ' + JSON.stringify(data));
        });

        function requestMatch() {
            const userId = document.getElementById('userId').value;
            if (!userId) {
                addMessage('Error: User ID is required');
                return;
            }

            const matchRequest = {
                userId: userId,
                topic: document.getElementById('topic').value,
                difficulty: document.getElementById('difficulty').value,
                timestamp: Date.now()
            };
            socket.emit('requestMatch', matchRequest);
            addMessage('Sent match request: ' + JSON.stringify(matchRequest));
        }

        function cancelMatch() {
            const userId = document.getElementById('userId').value;
            if (!userId) {
                addMessage('Error: User ID is required');
                return;
            }

            const cancelRequest = {
                userId: userId
            };
            socket.emit('cancelMatch', cancelRequest);
            addMessage('Sent cancel request: ' + JSON.stringify(cancelRequest));
        }

        function addMessage(message) {
            const messagesDiv = document.getElementById('messages');
            const messageElement = document.createElement('p');
            messageElement.textContent = message;
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    </script>
</body>
</html>